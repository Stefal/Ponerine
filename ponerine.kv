#:kivy 1.9.0
#:import kivy kivy
#:import Factory kivy.factory.Factory

<ConnectScreen>:
  #set back ground color
  AnchorLayout:
    anchor_x: 'left'
    anchor_y: 'top'
    canvas:
      Color: 
        rgba: 0.9,0.9,0.9,1
      Rectangle:
        size: self.size
        pos: self.pos
        #source: 'image/background.png'
    #title & logo
    GridLayout:
      canvas:
        Color: 
          rgba: 0.8,0.8,0.8,1
        Rectangle:
          size: self.size
          pos: self.pos
      size_hint: None, None
      size: root.width, root.width/15 + root.width/20
      #padding: left,top,right,bottom
      padding: root.width/40, root.width/40, 0, root.width/40
      spacing: root.width/40
      cols: 2
      Button:
        id: btnLogo
        size_hint: None, None
        size: root.width/15, root.width/15
        background_disabled_normal: 'image/ponerine.png'
        state: 'normal'
        disabled: True
      Label:
        text_size: self.size
        halign: 'left'
        valign: 'middle'
        color: 0,0,0,1
        #font_size: root.width/40
        text: 'Ponerine %s for XiaoYi Sports Camera' %app.version
    # camera icon
    GridLayout:
      size_hint: None, None
      size: root.width, root.width/2 + root.width/30
      spacing: root.width/25, 0
      padding: root.width/25,root.width/15+root.width/40,root.width/25,0 #root.width/30
      #padding: root.width/30,root.width/15,root.width/30,root.width/30
      cols: 2
      Button:
        text: "" #"W: %d H: %d" %(btnLogo.width, btnLogo.height) #"Button W: %d H: %d" %(self.width, self.height)
        id: btnCam1
        background_normal: 'image/camera_add_normal.png'
        background_down: 'image/camera_add_down.png'
        on_release: root.manager.ConfigPopupOpen(0)
      Button:
        text: "" #"Root W: %d H: %d" %(root.width, root.height)
        id: btnCam2
        background_normal: 'image/camera_add_normal.png'
        background_down: 'image/camera_add_down.png'
        on_release: root.manager.ConfigPopupOpen(1)
    # connect icon
    AnchorLayout:
      anchor_x: 'center'
      anchor_y: 'bottom'
      size_hint: None, None
      size: root.width, root.height * 0.8
      #padding: 0,0,0,root.width/10
      Button:
        id: btnConnect
        background_normal: 'image/connect_normal.png'
        background_down: 'image/connect_down.png'
        background_disabled_normal: 'image/connect_down.png'
        background_disabled_down: 'image/connect_down.png'
        size_hint: None, None
        size: root.width/4, root.width/4
        text: ''
        color: 1,0,0,1
        font_size: int(root.width/40)
        on_release: root.manager.Connect()

<CameraScreen>:
  BoxLayout:
    orientation: 'vertical'
    canvas:
      Color: 
        rgba: 0,0,0,1
      Rectangle:
        size: self.size
        pos: self.pos
    GridLayout:
      id: layTitle
      canvas:
        Color: 
          rgba: 0.8,0.8,0.8,1
        Rectangle:
          size: self.size
          pos: self.pos
      size_hint: None, None
      size: root.width, root.width/15 + root.width/20 #root.width/5
      padding: root.width/40, root.width/100, root.width/40, root.width/100
      #spacing=((width-padding) - icon.width * 5)/4
      spacing: ((root.width-root.width/20) - (root.width/15+root.width/20-root.width/50)*5)/4
      cols: 5
      Button:
        id: btnWifi
        background_normal: 'image/wifi-2.png'
        background_down: 'image/wifi-1.png'
        on_release: root.manager.Disconnect()
      Button:
        id: btnPicture
        background_normal: 'image/picture-2.png'
        background_down: 'image/picture-1.png'
        on_release: root.manager.FileManager()
      Button:
        id: btnCamera
        disabled: True
        background_disabled_normal: 'image/camera-1.png'
        #background_down: 'image/camera-1.png'
      Button:
        id: btnSetting
        background_normal: 'image/setting-2.png'
        background_down: 'image/setting-1.png'
        on_release: root.manager.Setting()
      Button:
        id: btnRadiation
        background_normal: 'image/radiation-2.png'
        background_down: 'image/radiation-1.png'
    TextInput:
      id: txtDebug
      size_hint: 1, 0.75
      text: "Camera Screen Debug Log :\nButton btnWifi W: %d H: %d\nGridlayout W: %d H: %d" %(btnWifi.width, btnWifi.height, layTitle.width, layTitle.height)
      #text: "Camera Screen Debug Log :\n"
      font_size: int(root.width/50)
      foreground_color: [1,1,0,1]
      background_color: [0,0,0,1]
      readonly: True
    GridLayout:
      cols: 2
      size_hint: 1, 0.25
      Label:
        id: lblCam1
        size_hint: 1, 0.5
        padding: [0, int(root.width/60)]
        text: "CAM 1 [ --:--:-- ]"
        color: 1,0,0,0.8
        font_size: int(root.width/30)
      Label:
        size_hint: 1, 0.5
        id: lblCam2
        padding: [0, int(root.width/60)]
        text: "CAM 2 [ --:--:-- ]"
        color: 1,0,0,0.8
        font_size: int(root.width/30)
      Button:
        size_hint: 1, 2
        id: btnPhoto
        text: 'Take Photo'
        font_size: int(root.width/20)
        on_release: root.manager.Photo()
      Button:
        size_hint: 1, 2
        id: btnRecord
        text: 'Start Record'
        font_size: int(root.width/20)
        on_release: root.manager.Record()

<FileManagerScreen>:
  BoxLayout:
    orientation: 'vertical'
    canvas:
      Color: 
        rgba: 0,0,0,1
      Rectangle:
        size: self.size
        pos: self.pos
    GridLayout:
      canvas:
        Color: 
          rgba: 0.8,0.8,0.8,1
        Rectangle:
          size: self.size
          pos: self.pos
      size_hint: None, None
      size: root.width, root.width/15 + root.width/20 #root.width/5
      padding: root.width/40, root.width/100, root.width/40, root.width/100
      #spacing=((width-padding) - icon.width * 5)/4
      spacing: ((root.width-root.width/20) - (root.width/15+root.width/20-root.width/50)*5)/4
      cols: 5
      Button:
        id: btnWifi
        background_normal: 'image/wifi-2.png'
        background_down: 'image/wifi-1.png'
        on_release: 
          root.manager.Disconnect()
      Button:
        id: btnPicture
        disabled: True
        background_disabled_normal: 'image/picture-1.png'
        #background_down: 'image/picture-1.png'
      Button:
        id: btnCamera
        background_normal: 'image/camera-2.png'
        background_down: 'image/camera-1.png'
        on_release: root.manager.Camera()
      Button:
        id: btnSetting
        background_normal: 'image/setting-2.png'
        background_down: 'image/setting-1.png'
        on_release: root.manager.Setting()
      Button:
        id: btnRadiation
        background_normal: 'image/radiation-2.png'
        background_down: 'image/radiation-1.png'
    TextInput:
      id: txtDebug
      size_hint: 1, 1
      text: "File List Debug Log :\n"
      font_size: int(root.width/50)
      foreground_color: [1,1,0,1]
      background_color: [0,0,0,1]
      readonly: True

<SettingScreen>:
  BoxLayout:
    orientation: 'vertical'
    GridLayout:
      canvas:
        Color: 
          rgba: 0.8,0.8,0.8,1
        Rectangle:
          size: self.size
          pos: self.pos
      size_hint: None, None
      size: root.width, root.width/15 + root.width/20 #root.width/5
      padding: root.width/40, root.width/100, root.width/40, root.width/100
      #spacing=((width-padding) - icon.width * 5)/4
      spacing: ((root.width-root.width/20) - (root.width/15+root.width/20-root.width/50)*5)/4
      cols: 5
      Button:
        id: btnWifi
        background_normal: 'image/wifi-2.png'
        background_down: 'image/wifi-1.png'
        on_release: 
          root.manager.Disconnect()
      Button:
        id: btnPicture
        background_normal: 'image/picture-2.png'
        background_down: 'image/picture-1.png'
        on_release: root.manager.FileManager()
      Button:
        id: btnCamera
        background_normal: 'image/camera-2.png'
        background_down: 'image/camera-1.png'
        on_release: root.manager.Camera()
      Button:
        id: btnSetting
        disabled: True
        background_disabled_normal: 'image/setting-1.png'
        #background_down: 'image/setting-1.png'
        #on_release: root.manager.Setting()
      Button:
        id: btnRadiation
        background_normal: 'image/radiation-2.png'
        background_down: 'image/radiation-1.png'
    TextInput:
      id: txtDebug
      size_hint: 1, 8
      text: "Setting Screen is under construction ...\n\nDebug Log:\n"
      font_size: int(root.width/50)
      foreground_color: [1,1,0,1]
      background_color: [0,0,0,1]
      readonly: True
    Button:
      size_hint: 1, 1
      text: 'Read Settings'
      font_size: int(root.width/20)
      on_release: root.manager.ReadSetting()

<ConfigPopup>:
  auto_dismiss: False
  #title: 'Camera Connection Config'
  BoxLayout:
    orientation: 'vertical'
    spacing: 5
    
    Widget:
      size_hint: 1, None
      size: root.width, root.width/20
    
    # Camera Enabled
    GridLayout:
      size_hint: 1, None
      height: root.width/10 + root.width/40
      padding: 0,0,0,root.width/40
      spacing: root.width/35
      cols: 3
      Label:
        text: 'Camera Enabled : '
        size_hint: 0.4, 1
        text_size: self.size
        font_size: root.width/25
        halign: 'right'
        valign: 'middle'
      Switch:
        id: optEnabled
        active: root.cfg["ip"] <> ""
        size_hint: 0.25, 1
        text_size: self.size
        font_size: root.width/25
      Label:
        size_hint: 0.35, 1
    
    #Default IP Address
    GridLayout:
      disabled: (True if optWifiMode.active else False) if optEnabled.active else True
      size_hint: 1, None
      height: root.width/10+root.width/40
      padding: 0,0,0,root.width/40
      spacing: root.width/35
      cols: 3
      Label:
        text: 'Default Mode IP : '
        size_hint: 0.4, 1
        text_size: self.size
        font_size: root.width/25
        halign: 'right'
        valign: 'middle'
      TextInput:
        id: txtDefaultIP
        multiline: False
        text: root.cfg["defaultip"]
        size_hint: 0.4, 1
        font_size: root.width/20
        padding: root.width/60, root.width/50, 0, 0
      Label:
        size_hint: 0.2, 1
    
    # AP / Station Mode
    GridLayout:
      disabled: False if optEnabled.active else True
      size_hint: 1, None
      height: root.width/10 + root.width/40
      padding: 0,0,0,root.width/40
      spacing: root.width/35
      cols: 3
      Label:
        text: 'Station Mode : '
        size_hint: 0.4, 1
        text_size: self.size
        font_size: root.width/25
        halign: 'right'
        valign: 'middle'
      Switch:
        id: optWifiMode
        active: root.cfg["wifimode"] == 1
        size_hint: 0.25, 1
        text_size: self.size
        font_size: root.width/25
      Label:
        size_hint: 0.35, 1
        
    #Station IP Address
    GridLayout:
      disabled: (False if optWifiMode.active else True) if optEnabled.active else True
      size_hint: 1, None
      height: root.width/10+root.width/40
      padding: 0,0,0,root.width/40
      spacing: root.width/35
      cols: 3
      Label:
        text: 'Station IP : ' 
        size_hint: 0.4, 1
        text_size: self.size
        font_size: root.width/25
        halign: 'right'
        valign: 'middle'
      TextInput:
        id: txtStationIP
        multiline: False
        text: root.cfg["stationip"]
        size_hint: 0.4, 1
        font_size: root.width/20
        padding: root.width/60, root.width/50, 0, 0
      Label:
        size_hint: 0.2, 1
    
    #Gateway IP Address
    GridLayout:
      disabled: (False if optWifiMode.active else True) if optEnabled.active else True
      size_hint: 1, None
      height: root.width/10+root.width/40
      padding: 0,0,0,root.width/40
      spacing: root.width/35
      cols: 3
      Label:
        text: 'Gateway : ' 
        size_hint: 0.4, 1
        text_size: self.size
        font_size: root.width/25
        halign: 'right'
        valign: 'middle'
      TextInput:
        id: txtGateway
        multiline: False
        text: root.cfg["gateway"]
        size_hint: 0.4, 1
        font_size: root.width/20
        padding: root.width/60, root.width/50, 0, 0
      Label:
        size_hint: 0.2, 1
    
    #SSID Name
    GridLayout:
      disabled: (False if optWifiMode.active else True) if optEnabled.active else True
      size_hint: 1, None
      height: root.width/10+root.width/40
      padding: 0,0,0,root.width/40
      spacing: root.width/35
      cols: 3
      Label:
        text: 'SSID Name : ' 
        size_hint: 0.4, 1
        text_size: self.size
        font_size: root.width/25
        halign: 'right'
        valign: 'middle'
      TextInput:
        id: txtSSID
        multiline: False
        text: root.cfg["ssid"]
        size_hint: 0.4, 1
        font_size: root.width/20
        padding: root.width/60, root.width/50, 0, 0
      Label:
        size_hint: 0.2, 1
    
    #Password
    GridLayout:
      disabled: (False if optWifiMode.active else True) if optEnabled.active else True
      size_hint: 1, None
      height: root.width/10+root.width/40
      padding: 0,0,0,root.width/40
      spacing: root.width/35
      cols: 3
      Label:
        text: 'SSID Password : ' 
        size_hint: 0.4, 1
        text_size: self.size
        font_size: root.width/25
        halign: 'right'
        valign: 'middle'
      TextInput:
        id: txtPassword
        password: chkShowPass.active
        multiline: False
        text: root.cfg["password"]
        size_hint: 0.4, 1
        font_size: root.width/20
        padding: root.width/60, root.width/50, 0, 0
      CheckBox:
        id: chkShowPass
        active: True
        size_hint: 0.2, 1
    
    AnchorLayout:
      anchor_x: 'center'
      anchor_y: 'bottom'
      orientation: 'horizontal'
      size_hint: 1, 1
      GridLayout:
        cols: 2
        size_hint: None, None
        size: root.width*0.8, root.width*0.15+root.width/20
        padding: 0,0,0,root.width/20
        spacing: root.width/20
        # Apply Button
        Button:
          text: 'Apply'
          size_hint: 1, 1
          on_release:
            root.apply = True
            root.cfg["camera"] = root.index+1
            root.cfg["ip"] = (txtStationIP.text if optWifiMode.active else txtDefaultIP.text) if optEnabled.active else ""
            root.cfg["defaultip"] = txtDefaultIP.text
            root.cfg["wifimode"] = 1 if optWifiMode.active else 0
            root.cfg["stationip"] = txtStationIP.text
            root.cfg["gateway"] = txtGateway.text
            root.cfg["ssid"] = txtSSID.text
            root.cfg["password"] = txtPassword.text
            root.dismiss()
        # Cancel Button
        Button:
          text: 'Cancel'
          size_hint: 1, 1
          on_release:
            root.apply = False
            root.dismiss()
