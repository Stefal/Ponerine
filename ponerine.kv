#:kivy 1.9.0
#:import kivy kivy
#:import Factory kivy.factory.Factory 

<ConfigPopup>:
  auto_dismiss: False
  #title: 'Camera Connection Config'
  BoxLayout:
    orientation: 'vertical'
    spacing: 5
    
    Widget:
      size_hint: 1, None
      size: root.width, root.width/20
    
    # Camera Enabled
    GridLayout:
      size_hint: 1, None
      height: root.width/13 + root.width/50
      padding: 0,0,0,root.width/50
      spacing: root.width/35
      cols: 3
      Label:
        text: 'Camera Enabled : '
        size_hint: 0.4, 1
        text_size: self.size
        font_size: root.width/25
        halign: 'right'
        valign: 'middle'
      Switch:
        id: optEnabled
        active: root.cfg["ip"] <> ""
        size_hint: 0.25, 1
        #text_size: self.size
        #font_size: root.width/50
      Label:
        size_hint: 0.35, 1
    
    #Default IP Address
    GridLayout:
      disabled: (True if optWifiMode.active else False) if optEnabled.active else True
      size_hint: 1, None
      height: root.width/13 + root.width/50
      padding: 0,0,0,root.width/50
      spacing: root.width/35
      cols: 3
      Label:
        text: 'Default Mode IP : '
        size_hint: 0.4, 1
        text_size: self.size
        font_size: root.width/25
        halign: 'right'
        valign: 'middle'
      TextInput:
        id: txtDefaultIP
        multiline: False
        text: root.cfg["defaultip"]
        size_hint: 0.4, 1
        font_size: root.width/25
        padding: root.width/60, root.width/70, 0, 0
      Label:
        size_hint: 0.2, 1
    
    # AP / Station Mode
    GridLayout:
      disabled: False if optEnabled.active else True
      size_hint: 1, None
      height: root.width/13 + root.width/50
      padding: 0,0,0,root.width/50
      spacing: root.width/35
      cols: 3
      Label:
        text: 'Station Mode : '
        size_hint: 0.4, 1
        text_size: self.size
        font_size: root.width/25
        halign: 'right'
        valign: 'middle'
      Switch:
        id: optWifiMode
        active: root.cfg["wifimode"] == 1
        size_hint: 0.25, 1
        text_size: self.size
        font_size: root.width/50
      Label:
        size_hint: 0.35, 1
        
    #Station IP Address
    GridLayout:
      disabled: (False if optWifiMode.active else True) if optEnabled.active else True
      size_hint: 1, None
      height: root.width/13 + root.width/50
      padding: 0,0,0,root.width/50
      spacing: root.width/35
      cols: 3
      Label:
        text: 'Station IP : '
        size_hint: 0.4, 1
        text_size: self.size
        font_size: root.width/25
        halign: 'right'
        valign: 'middle'
      TextInput:
        id: txtStationIP
        multiline: False
        text: root.cfg["stationip"]
        size_hint: 0.4, 1
        font_size: root.width/25
        padding: root.width/60, root.width/70, 0, 0
      Label:
        size_hint: 0.2, 1
    
    #Gateway IP Address
    GridLayout:
      disabled: (False if optWifiMode.active else True) if optEnabled.active else True
      size_hint: 1, None
      height: root.width/13 + root.width/50
      padding: 0,0,0,root.width/50
      spacing: root.width/35
      cols: 3
      Label:
        text: 'Gateway : ' 
        size_hint: 0.4, 1
        text_size: self.size
        font_size: root.width/25
        halign: 'right'
        valign: 'middle'
      TextInput:
        id: txtGateway
        multiline: False
        text: root.cfg["gateway"]
        size_hint: 0.4, 1
        font_size: root.width/25
        padding: root.width/60, root.width/70, 0, 0
      Label:
        size_hint: 0.2, 1
    
    #SSID Name
    GridLayout:
      disabled: (False if optWifiMode.active else True) if optEnabled.active else True
      size_hint: 1, None
      height: root.width/13 + root.width/50
      padding: 0,0,0,root.width/50
      spacing: root.width/35
      cols: 3
      Label:
        text: 'SSID Name : ' 
        size_hint: 0.4, 1
        text_size: self.size
        font_size: root.width/25
        halign: 'right'
        valign: 'middle'
      TextInput:
        id: txtSSID
        multiline: False
        text: root.cfg["ssid"]
        size_hint: 0.4, 1
        font_size: root.width/25
        padding: root.width/60, root.width/70, 0, 0
      Label:
        size_hint: 0.2, 1
    
    #Password
    GridLayout:
      disabled: (False if optWifiMode.active else True) if optEnabled.active else True
      size_hint: 1, None
      height: root.width/13 + root.width/50
      padding: 0,0,0,root.width/50
      spacing: root.width/35
      cols: 3
      Label:
        text: 'SSID Password : ' 
        size_hint: 0.4, 1
        text_size: self.size
        font_size: root.width/25
        halign: 'right'
        valign: 'middle'
      TextInput:
        id: txtPassword
        password: chkShowPass.active
        multiline: False
        text: root.cfg["password"]
        size_hint: 0.4, 1
        font_size: root.width/25
        padding: root.width/60, root.width/70, 0, 0
      CheckBox:
        id: chkShowPass
        active: True
        size_hint: 0.2, 1
    
    #Download Dir
    GridLayout:
      size_hint: 1, None
      height: root.width/13 + root.width/50
      padding: 0,0,0,root.width/50
      spacing: root.width/60
      cols: 2
      Label:
        text: 'Download : ' 
        size_hint: None, None
        size: root.width*0.24, root.width/13
        text_size: (root.width*0.24, root.width/13) #self.size
        font_size: root.width/25
        halign: 'right'
        valign: 'middle'
      TextInput:
        id: txtDownload
        multiline: False
        text: root.cfg["download"]
        size_hint: None, None
        size: root.width*0.64, root.width/13
        font_size: root.width/30
        padding: root.width/60, root.width/60, 0, 0
        
    #Upload Dir
    GridLayout:
      size_hint: 1, None
      height: root.width/13 + root.width/50
      padding: 0,0,0,root.width/50
      spacing: root.width/60
      cols: 2
      Label:
        text: 'Upload : ' 
        size_hint: None, None
        size: root.width*0.24, root.width/13
        text_size: (root.width*0.24, root.width/13) #self.size
        font_size: root.width/25
        halign: 'right'
        valign: 'middle'
      TextInput:
        id: txtUpload
        multiline: False
        text: root.cfg["upload"]
        size_hint: None, None
        size: root.width*0.64, root.width/13
        font_size: root.width/30
        padding: root.width/60, root.width/60, 0, 0
    
    AnchorLayout:
      anchor_x: 'center'
      anchor_y: 'bottom'
      orientation: 'horizontal'
      size_hint: 1, 1
      GridLayout:
        cols: 2
        size_hint: None, None
        size: root.width*0.8, root.width*0.15+root.width/20
        padding: 0,0,0,root.width/20
        spacing: root.width/20
        # Apply Button
        Button:
          text: 'Apply'
          size_hint: 1, 1
          on_release:
            root.apply = True
            root.cfg["camera"] = root.index+1
            root.cfg["ip"] = (txtStationIP.text if optWifiMode.active else txtDefaultIP.text) if optEnabled.active else ""
            root.cfg["defaultip"] = txtDefaultIP.text
            root.cfg["wifimode"] = 1 if optWifiMode.active else 0
            root.cfg["stationip"] = txtStationIP.text
            root.cfg["gateway"] = txtGateway.text
            root.cfg["ssid"] = txtSSID.text
            root.cfg["password"] = txtPassword.text
            root.cfg["download"] = txtDownload.text
            root.cfg["upload"] = txtUpload.text
            root.dismiss()
        # Cancel Button
        Button:
          text: 'Cancel'
          size_hint: 1, 1
          on_release:
            root.apply = False
            root.dismiss()

<DeletePopup>:
  auto_dismiss: False
  #title: 'File Delete Confirmation'
  BoxLayout:
    orientation: 'vertical'
    spacing: 5
    
    #Widget:
      #size_hint: 1, None
      #size: root.width, root.width/50
    Label:
      text: "Do you really want to delete files in camera ?"
      font_size: root.width/25
    AnchorLayout:
      anchor_x: 'center'
      anchor_y: 'bottom'
      orientation: 'horizontal'
      size_hint: 1, 1
      GridLayout:
        cols: 2
        size_hint: None, None
        size: root.width*0.8, root.width*0.15+root.width/20
        padding: 0,0,0,root.width/20
        spacing: root.width/20
        # Apply Button
        Button:
          text: 'Delete'
          size_hint: 1, 1
          on_release:
            root.apply = True
            root.dismiss()
        # Cancel Button
        Button:
          text: 'Cancel'
          size_hint: 1, 1
          on_release:
            root.apply = False
            root.dismiss()

<RebootPopup>:
  auto_dismiss: False
  #title: 'Reboot'
  BoxLayout:
    orientation: 'vertical'
    spacing: 5
    
    #Widget:
      #size_hint: 1, None
      #size: root.width, root.width/50
    Label:
      text: "Camera %d needs reboot to make settings effective .\nDo you want to reboot now ?" %(root.index+1)
      font_size: root.width/25
    AnchorLayout:
      anchor_x: 'center'
      anchor_y: 'bottom'
      orientation: 'horizontal'
      size_hint: 1, 1
      GridLayout:
        cols: 2
        size_hint: None, None
        size: root.width*0.8, root.width*0.15+root.width/20
        padding: 0,0,0,root.width/20
        spacing: root.width/20
        # Apply Button
        Button:
          text: 'Reboot'
          size_hint: 1, 1
          on_release:
            root.apply = True
            root.dismiss()
        # Cancel Button
        Button:
          text: 'Cancel'
          size_hint: 1, 1
          on_release:
            root.apply = False
            root.dismiss()

<ProgressPopup>:
  auto_dismiss: False
  #title: 'Reboot'
  BoxLayout:
    orientation: 'vertical'
    spacing: 5
    
    #Widget:
      #size_hint: 1, None
      #size: root.width, root.width/50
    Label:
      id: txtProgress
      text: "Camera %d Injecting ..." %(root.index+1)
      font_size: root.width/25
            